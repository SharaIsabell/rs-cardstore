<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meus Pedidos - RS Card Store</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/carrinho.css"> <style>
        .order-list { 
            list-style: none; 
            padding: 0; 
            margin-top: 2rem;
        }
        .order-card { 
            background: var(--color-gray-light); 
            border: 1px solid #e0e0e0;
            border-radius: 8px; 
            margin-bottom: 2rem; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        .order-header { 
            display: flex; 
            justify-content: space-between; 
            flex-wrap: wrap;
            gap: 1.5rem;
            padding: 1.5rem; 
            background: var(--color-white);
            border-bottom: 1px solid #e0e0e0;
            border-radius: 8px 8px 0 0;
        }
        .order-header div { 
            display: flex; 
            flex-direction: column; 
        }
        .order-header span {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 4px;
        }
        .order-header strong { 
            font-family: var(--font-heading); 
            color: var(--color-blue-dark);
            font-size: 1.1rem;
            text-transform: capitalize;
        }
        .order-body { 
            padding: 1.5rem; 
            display: flex; 
            justify-content: space-between;
            align-items: center; 
            gap: 1.5rem; 
            flex-wrap: wrap;
        }
        .order-items-preview { 
            display: flex; 
            gap: 1rem; 
            flex-grow: 1; 
            align-items: center;
        }
        .order-items-preview img { 
            width: 60px; 
            height: 60px; 
            object-fit: contain;
            border-radius: 4px; 
            background: var(--color-white);
            border: 1px solid #eee;
        }
        .order-items-preview .items-plus {
            font-style: italic;
            color: #555;
        }
        .order-actions { 
            min-width: 180px; 
            text-align: right; 
        }
        .order-actions .cta-button { 
            padding: 0.8rem 1.5rem; 
            font-size: 0.9rem;
        }
        .order-actions .cta-button.disabled { 
            background-color: #ccc; 
            border-color: #ccc; 
            color: #666;
            cursor: not-allowed; 
        }

        /* Ajustes para Modo Escuro */
        body.dark-mode .order-card { border-color: #2a3b52; }
        body.dark-mode .order-header { background: var(--color-white); border-color: #2a3b52; }
        body.dark-mode .order-header span { color: #aaa; }
        body.dark-mode .order-items-preview img { background: var(--color-gray-light); border-color: #2a3b52; }
        body.dark-mode .order-items-preview .items-plus { color: #ccc; }

        @media (max-width: 768px) {
            .order-header { flex-direction: column; gap: 1rem; }
            .order-body { flex-direction: column; align-items: stretch; }
            .order-actions { text-align: left; }
        }
    </style>
</head>
<body>
    <%- include('partials/header') %>

    <main class="container section">
        <h1 class="section-title">Meus Pedidos</h1>

        <% if (pedidos && pedidos.length > 0) { %>
            <ul class="order-list">
                <% pedidos.forEach(pedido => { %>
                    <li class="order-card">
                        <div class="order-header">
                            <div>
                                <span>Pedido ID</span>
                                <strong>#<%= pedido.id %></strong>
                            </div>
                            <div>
                                <span>Data</span>
                                <strong><%= pedido.data_pedido %></strong>
                            </div>
                            <div>
                                <span>Total</span>
                                <strong>R$ <%= parseFloat(pedido.total).toFixed(2) %></strong>
                            </div>
                            <div>
                                <span>Status</span>
                                <strong><%= pedido.status %></strong>
                            </div>
                        </div>
                        
                        <div class="order-body">
                            <div class="order-items-preview">
                                <% pedido.itens.slice(0, 4).forEach(item => { %>
                                    <img src="<%= item.imagem_url %>" alt="<%= item.nome %>" title="<%= item.nome %>">
                                <% }) %>
                                <% if (pedido.itens.length > 4) { %>
                                    <span class="items-plus">+ <%= pedido.itens.length - 4 %> outro(s) item(ns)</span>
                                <% } %>
                            </div>
                            
                            <div class="order-actions">
                                <% if (pedido.link_arquivo) { %>
                                    <a href="<%= pedido.link_arquivo %>" class="cta-button" target="_blank">
                                        <i class="fa-solid fa-file-invoice"></i> Ver Nota Fiscal
                                    </a>
                                <% } else { %>
                                    <button class="cta-button disabled" disabled>NF Indisponível</button>
                                <% } %>
                            </div>
                        </div>
                    </li>
                <% }) %>
            </ul>
        <% } else { %>
            <div class="empty-cart" style="text-align: center; padding: 4rem 0;">
                <h2>Você ainda não fez nenhum pedido.</h2>
                <p style="margin-top: 1rem; margin-bottom: 2rem;">Explore nossos produtos e comece a colecionar!</p>
                <a href="/" class="cta-button">Voltar para a loja</a>
            </div>
        <% } %>
    </main>

    <%- include('partials/footer') %>
    <script src="/js/theme.js"></script>
</body>
</html>